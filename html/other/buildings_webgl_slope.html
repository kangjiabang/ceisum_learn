<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cesium 3D Tileset with Slope Highlight</title>
  <!-- 修复：CDN URL 多余空格 -->
  <script src="https://cdn.jsdelivr.net/npm/cesium@1.130/Build/Cesium/Cesium.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/cesium@1.130/Build/Cesium/Widgets/widgets.css" rel="stylesheet" />
  <style>
    html,
    body,
    #cesiumContainer {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <div id="cesiumContainer"></div>
  <script type="module">
    // 设置访问令牌
    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI1OGIzZmQyZC03YjNiLTQzMjQtOWQxYS0xOTYxZWUyMTYzMjQiLCJpZCI6MzEzMjQxLCJpYXQiOjE3NTAyMjc2NDd9.G9X0WofFDt3mbp2L_WDzU__rcAVg0v3rpAliG1sgB9k';

    // 初始化 Viewer
    const viewer = new Cesium.Viewer("cesiumContainer", {
      terrainProvider: await Cesium.CesiumTerrainProvider.fromIonAssetId(1, {
        requestVertexNormals: true,
        requestWaterMask: true
      }),
      sceneMode: Cesium.SceneMode.SCENE3D,
      baseLayerPicker: false,
      animation: false,
      timeline: false,
      infoBox: false,
      fullscreenButton: false,
    });

    viewer.scene.globe.depthTestAgainstTerrain = true;

    try {
      // ✅ 加载 3D Tileset
      const tileset = await Cesium.Cesium3DTileset.fromUrl("http://192.168.4.78:8000/tileset.json");
      viewer.scene.primitives.add(tileset);

      // 监听加载进度
      tileset.loadProgress.addEventListener(function (numberOfPendingRequests) {
        console.log("3D Tiles 加载中，待处理请求数:", numberOfPendingRequests);
      });

      // 飞到模型
      await viewer.zoomTo(tileset);
      console.log("3D Tileset 加载完成");



    } catch (error) {
      console.error("加载 3D Tileset 失败:", error);
      alert("3D 模型加载失败，请检查：\n1. 服务是否运行\n2. CORS 是否开启\n3. tileset.json 是否有效");
    }
  </script>
</body>

</html>