<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Babylon.js 明显下雨特效</title>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            overflow: hidden;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>
</head>

<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        const canvas = document.getElementById("renderCanvas");
        const engine = new BABYLON.Engine(canvas, true);

        const createScene = () => {
            const scene = new BABYLON.Scene(engine);
            scene.clearColor = new BABYLON.Color3(0.5, 0.5, 0.5); // 阴天背景

            // 相机
            const camera = new BABYLON.ArcRotateCamera("camera", Math.PI / 2, Math.PI / 4, 50, BABYLON.Vector3.Zero(), scene);
            camera.attachControl(canvas, true);

            // 光源
            const light = new BABYLON.DirectionalLight("dirLight", new BABYLON.Vector3(-1, -2, -1), scene);
            light.intensity = 0.8;

            // 地面
            const ground = BABYLON.MeshBuilder.CreateGround("ground", { width: 100, height: 100 }, scene);

            // 雨滴粒子系统
            const rain = new BABYLON.ParticleSystem("rain", 5000, scene);
            rain.particleTexture = new BABYLON.Texture("https://i.imgur.com/7qZ6sQx.png", scene); // 长条雨滴贴图
            rain.emitter = new BABYLON.Vector3(0, 30, 0); // 雨从高处下
            rain.minEmitBox = new BABYLON.Vector3(-50, 20, -50);
            rain.maxEmitBox = new BABYLON.Vector3(50, 40, 50);

            rain.color1 = new BABYLON.Color4(0.7, 0.7, 1, 1);
            rain.color2 = new BABYLON.Color4(0.7, 0.7, 1, 1);
            rain.colorDead = new BABYLON.Color4(0.7, 0.7, 1, 0);

            rain.minSize = 0.2;
            rain.maxSize = 0.5;

            rain.minLifeTime = 2;
            rain.maxLifeTime = 3;

            rain.emitRate = 3000;

            rain.gravity = new BABYLON.Vector3(0, -9.81, 0);
            rain.direction1 = new BABYLON.Vector3(0, -1, 0);
            rain.direction2 = new BABYLON.Vector3(0, -1, 0);

            rain.minAngularSpeed = 0;
            rain.maxAngularSpeed = 0;

            rain.minEmitPower = 20;
            rain.maxEmitPower = 30;
            rain.updateSpeed = 0.01;

            rain.start();

            return scene;
        };

        const scene = createScene();
        engine.runRenderLoop(() => scene.render());

        window.addEventListener("resize", () => engine.resize());
    </script>
</body>

</html>